<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprint Reports</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .filters {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        select, button {
            padding: 8px 12px;
            margin-right: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
        }
        .section-description {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 4px;
            border-left: 4px solid #007bff;
            display: none;
        }
        .section-description.visible {
            display: block;
        }
        .toggle-button {
            background: none;
            border: none;
            color: #007bff;
            cursor: pointer;
            font-size: 0.9em;
            padding: 4px 8px;
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .toggle-button:hover {
            background: #f8f9fa;
            border-radius: 4px;
        }
        .toggle-icon {
            transition: transform 0.2s;
        }
        .toggle-icon.rotated {
            transform: rotate(90deg);
        }
        .issues-column {
            display: none;
        }
        .issues-column.visible {
            display: table-cell;
        }
        .metric-explanation {
            margin-left: 20px;
            color: #666;
            font-style: italic;
        }
        .leaderboard-section {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .leaderboard-title {
            text-align: center;
            font-size: 2em;
            margin-bottom: 20px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .leaderboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .leaderboard-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            cursor: pointer;
            text-decoration: none;
            color: white;
            display: block;
        }
        .leaderboard-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.2);
        }
        .leaderboard-card-title {
            font-size: 1.3em;
            color: #fff;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .leaderboard-card-description {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        .leaderboard-entry {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .leaderboard-medal {
            font-size: 1.2em;
            min-width: 24px;
        }
        .completion-high { color: #28a745; }
        .completion-medium { color: #ffc107; }
        .completion-low { color: #dc3545; }
        .hidden { display: none; }
        #summaryTable td:last-child {
            min-width: 200px;
        }
        #summaryTable td:last-child div {
            margin: 4px 0;
            padding: 2px 6px;
            border-radius: 4px;
            background: #f8f9fa;
        }
        .completion-high {
            color: #28a745 !important;
        }
        .completion-medium {
            color: #ffc107 !important;
        }
        .completion-low {
            color: #dc3545 !important;
        }
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sprint Reports</h1>

        <div class="leaderboard-section">
            <h2 class="leaderboard-title">üèÜ Sprint Champions</h2>
            <div class="leaderboard">
                <!-- Leaderboard content will be populated dynamically -->
            </div>
        </div>
        
        <div class="filters">
            <select id="sprintFilter">
                <option value="all">All Sprints</option>
                <!-- Sprint options will be populated dynamically -->
            </select>
            <select id="assigneeFilter">
                <option value="all">All Assignees</option>
                <!-- Assignee options will be populated dynamically -->
            </select>
            <button onclick="applyFilters()">Apply Filters</button>
            <button onclick="resetFilters()">Reset</button>
        </div>

        <div id="summary" class="section">
            <h2 class="section-title">Sprint Summary</h2>
            <button class="toggle-button" onclick="toggleExplanation('summary')">
                <span class="toggle-icon">‚ñ∂</span> Show calculation details
            </button>
            <div class="section-description" id="summary-explanation">
                <div>A high-level overview of sprint metrics:</div>
                <div class="metric-explanation">‚Ä¢ Total: All issues in the sprint</div>
                <div class="metric-explanation">‚Ä¢ UAT: Issues that reached "UAT Ready" status</div>
                <div class="metric-explanation">‚Ä¢ Done: Issues completed in the sprint</div>
                <div class="metric-explanation">‚Ä¢ %: Completion rate (Done/Total √ó 100)</div>
                <div class="metric-explanation">‚Ä¢ Hours: Time logged per person during sprint dates</div>
            </div>
            <table id="summaryTable">
                <thead>
                    <tr>
                        <th>Sprint</th>
                        <th>Start</th>
                        <th>End</th>
                        <th>Total</th>
                        <th>UAT</th>
                        <th>Done</th>
                        <th>%</th>
                        <th>Hours Breakdown</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Will be populated dynamically -->
                </tbody>
            </table>
        </div>

        <div id="missingEstimatesSection" class="section">
            <h2>Missing Estimates</h2>
            <button onclick="toggleCalculationDetails('missingEstimates')" class="toggle-button">
                Show/Hide Calculation Details
            </button>
            <div id="missingEstimatesDetails" class="calculation-details" style="display: none;">
                <p>This section shows:</p>
                <ul>
                    <li>Assignee: The person assigned to the issue</li>
                    <li>Count: Number of issues without original estimates</li>
                    <li>Issues: List of issue keys missing estimates</li>
                </ul>
            </div>
            <table id="missingEstimatesTable">
                <thead>
                    <tr>
                        <th>Sprint</th>
                        <th>Assignee</th>
                        <th>Count</th>
                        <th>Issues</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <div id="completion" class="section">
            <h2 class="section-title">Issue Completion</h2>
            <button class="toggle-button" onclick="toggleExplanation('completion')">
                <span class="toggle-icon">‚ñ∂</span> Show calculation details
            </button>
            <div class="section-description" id="completion-explanation">
                <div>Tracks who started and completed issues:</div>
                <div class="metric-explanation">‚Ä¢ Started: Issues moved from "To Do" by this person</div>
                <div class="metric-explanation">‚Ä¢ Done: Issues that reached "Done" status</div>
                <div class="metric-explanation">‚Ä¢ Issues: List of completed issues (with * for indirect transitions)</div>
                <div class="metric-explanation">‚Ä¢ Color coding: ‚â•80% green, ‚â•50% yellow, <50% red</div>
            </div>
            <div style="text-align: right; margin-bottom: 10px;">
                <button class="toggle-button" onclick="toggleIssuesColumn('completion')">
                    <span class="toggle-icon">‚ñ∂</span> Show issue details
                </button>
            </div>
            <table id="completionTable">
                <!-- Completion table content will be populated dynamically -->
            </table>
        </div>

        <div id="reviewers" class="section">
            <h2 class="section-title">Reviewers</h2>
            <button class="toggle-button" onclick="toggleExplanation('reviewers')">
                <span class="toggle-icon">‚ñ∂</span> Show calculation details
            </button>
            <div class="section-description" id="reviewers-explanation">
                <div>Shows code review activity:</div>
                <div class="metric-explanation">‚Ä¢ Reviewer: Person who reviewed the code</div>
                <div class="metric-explanation">‚Ä¢ Reviewed: Count of issues reviewed</div>
                <div class="metric-explanation">‚Ä¢ Issues: List of reviewed issues</div>
                <div class="metric-explanation">‚Ä¢ *: Indicates indirect transition (not directly from "PR Ready" to "Testing")</div>
            </div>
            <div style="text-align: right; margin-bottom: 10px;">
                <button class="toggle-button" onclick="toggleIssuesColumn('reviewers')">
                    <span class="toggle-icon">‚ñ∂</span> Show issue details
                </button>
            </div>
            <table id="reviewersTable">
                <!-- Reviewers table content will be populated dynamically -->
            </table>
        </div>

        <div id="shippers" class="section">
            <h2 class="section-title">Shippers</h2>
            <button class="toggle-button" onclick="toggleExplanation('shippers')">
                <span class="toggle-icon">‚ñ∂</span> Show calculation details
            </button>
            <div class="section-description" id="shippers-explanation">
                <div>Tracks deployment activity:</div>
                <div class="metric-explanation">‚Ä¢ Shipper: Person who deployed the code</div>
                <div class="metric-explanation">‚Ä¢ Shipped: Count of issues deployed</div>
                <div class="metric-explanation">‚Ä¢ Issues: List of shipped issues</div>
                <div class="metric-explanation">‚Ä¢ *: Indicates indirect transition (not directly from "Testing" to "UAT Ready")</div>
            </div>
            <div style="text-align: right; margin-bottom: 10px;">
                <button class="toggle-button" onclick="toggleIssuesColumn('shippers')">
                    <span class="toggle-icon">‚ñ∂</span> Show issue details
                </button>
            </div>
            <table id="shippersTable">
                <!-- Shippers table content will be populated dynamically -->
            </table>
        </div>

        <div id="spillover" class="section">
            <h2 class="section-title">Spillover Issues</h2>
            <button class="toggle-button" onclick="toggleExplanation('spillover')">
                <span class="toggle-icon">‚ñ∂</span> Show calculation details
            </button>
            <div class="section-description" id="spillover-explanation">
                <div>Tracks issues not completed within their sprint:</div>
                <div class="metric-explanation">‚Ä¢ Starter: Person who first moved the issue from "To Do"</div>
                <div class="metric-explanation">‚Ä¢ Count: Number of incomplete issues started by this person</div>
                <div class="metric-explanation">‚Ä¢ Issues: List of spillover issues with their start dates</div>
                <div class="metric-explanation">‚Ä¢ Age: Time since the issue was first started</div>
            </div>
            <div style="text-align: right; margin-bottom: 10px;">
                <button class="toggle-button" onclick="toggleIssuesColumn('spillover')">
                    <span class="toggle-icon">‚ñ∂</span> Show issue details
                </button>
            </div>
            <table id="spilloverTable">
                <!-- Spillover table content will be populated dynamically -->
            </table>
        </div>
    </div>

    <script>
        let sprintData = SPRINT_DATA_PLACEHOLDER; // Will be replaced with actual data
        let currentFilters = {
            sprint: 'all',
            assignee: 'all'
        };

        function getLatestSprint(data) {
            return data.reduce((latest, current) => {
                if (!latest) return current;
                return new Date(current.endDate) > new Date(latest.endDate) ? current : latest;
            }, null)?.name || 'all';
        }

        function initializeFilters() {
            const sprintFilter = document.getElementById('sprintFilter');
            const assigneeFilter = document.getElementById('assigneeFilter');
            const uniqueAssignees = new Set();

            // Add sprint options
            sprintData.forEach(sprint => {
                const option = document.createElement('option');
                option.value = sprint.name;
                option.textContent = sprint.name;
                sprintFilter.appendChild(option);

                // Collect unique assignees
                Object.keys(sprint.timeLogged).forEach(assignee => uniqueAssignees.add(assignee));
                Object.keys(sprint.completionStats).forEach(assignee => uniqueAssignees.add(assignee));
                Object.keys(sprint.reviewerStats).forEach(assignee => uniqueAssignees.add(assignee));
                Object.keys(sprint.shipperStats).forEach(assignee => uniqueAssignees.add(assignee));
            });

            // Add assignee options
            Array.from(uniqueAssignees).sort().forEach(assignee => {
                const option = document.createElement('option');
                option.value = assignee;
                option.textContent = assignee;
                assigneeFilter.appendChild(option);
            });

            // Set default to latest sprint
            const latestSprint = getLatestSprint(sprintData);
            sprintFilter.value = latestSprint;
            currentFilters.sprint = latestSprint;
        }

        function getCompletionColor(completed, total) {
            const percentage = (completed / total) * 100;
            if (percentage >= 80) return 'completion-high';
            if (percentage >= 50) return 'completion-medium';
            return 'completion-low';
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-GB', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        function applyFilters() {
            currentFilters.sprint = document.getElementById('sprintFilter').value;
            currentFilters.assignee = document.getElementById('assigneeFilter').value;
            updateTables();
        }

        function resetFilters() {
            document.getElementById('sprintFilter').value = 'all';
            document.getElementById('assigneeFilter').value = 'all';
            currentFilters = { sprint: 'all', assignee: 'all' };
            updateTables();
        }

        function filterData() {
            let filteredData = [...sprintData];
            
            if (currentFilters.sprint !== 'all') {
                filteredData = filteredData.filter(sprint => sprint.name === currentFilters.sprint);
            }

            if (currentFilters.assignee !== 'all') {
                filteredData = filteredData.map(sprint => {
                    const filtered = {...sprint};
                    // Filter timeLogged
                    filtered.timeLogged = Object.fromEntries(
                        Object.entries(sprint.timeLogged)
                            .filter(([assignee]) => assignee === currentFilters.assignee)
                    );
                    // Filter completionStats
                    filtered.completionStats = Object.fromEntries(
                        Object.entries(sprint.completionStats)
                            .filter(([assignee]) => assignee === currentFilters.assignee)
                    );
                    // Filter reviewerStats
                    filtered.reviewerStats = Object.fromEntries(
                        Object.entries(sprint.reviewerStats)
                            .filter(([assignee]) => assignee === currentFilters.assignee)
                    );
                    // Filter shipperStats
                    filtered.shipperStats = Object.fromEntries(
                        Object.entries(sprint.shipperStats)
                            .filter(([assignee]) => assignee === currentFilters.assignee)
                    );
                    return filtered;
                });
            }

            return filteredData;
        }

        function updateTables() {
            const filteredData = filterData();
            updateSummaryTable(filteredData);
            updateCompletionTable(filteredData);
            updateReviewersTable(filteredData);
            updateShippersTable(filteredData);
            updateSpilloverTable(filteredData);
            updateMissingEstimatesTable(filteredData);
            updateLeaderboard(filteredData);
        }

        function getCompletionColorClass(completed, total) {
            const percentage = (completed / total) * 100;
            if (percentage >= 80) return 'completion-high';
            if (percentage >= 50) return 'completion-medium';
            return 'completion-low';
        }

        function getTimeLogColorClass(hours) {
            if (hours > 60) return 'completion-high';
            if (hours > 40) return 'completion-medium';
            return 'completion-low';
        }

        function updateSummaryTable(data) {
            const table = document.getElementById('summaryTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';

            data.forEach(sprint => {
                if (currentFilters.sprint !== 'all' && sprint.name !== currentFilters.sprint) return;

                const row = document.createElement('tr');
                const completionPercentage = (sprint.completedIssues / sprint.totalIssues) * 100;
                const completionClass = getCompletionColorClass(sprint.completedIssues, sprint.totalIssues);

                // Create hours breakdown HTML
                const hoursBreakdown = Object.entries(sprint.timeLogged)
                    .map(([person, seconds]) => {
                        const hours = Math.round(seconds / 3600);
                        const colorClass = getTimeLogColorClass(hours);
                        return `<div class="${colorClass}">${person}: ${hours}h</div>`;
                    })
                    .join('');

                row.innerHTML = `
                    <td>${sprint.name}</td>
                    <td>${formatDate(sprint.startDate)}</td>
                    <td>${formatDate(sprint.endDate)}</td>
                    <td>${sprint.totalIssues}</td>
                    <td>${sprint.uatReadyIssues}</td>
                    <td class="${completionClass}">${sprint.completedIssues}</td>
                    <td class="${completionClass}">${Math.round(completionPercentage)}%</td>
                    <td>${hoursBreakdown}</td>
                `;

                tbody.appendChild(row);
            });

            // Add total row
            const totalRow = document.createElement('tr');
            const totalIssues = data.reduce((sum, s) => sum + s.totalIssues, 0);
            const totalCompleted = data.reduce((sum, s) => sum + s.completedIssues, 0);
            const totalUatReady = data.reduce((sum, s) => sum + s.uatReadyIssues, 0);
            const totalPercentage = (totalCompleted / totalIssues) * 100;
            const totalCompletionClass = getCompletionColorClass(totalCompleted, totalIssues);

            // Calculate total hours per person across all sprints
            const totalHours = {};
            data.forEach(sprint => {
                Object.entries(sprint.timeLogged).forEach(([person, seconds]) => {
                    totalHours[person] = (totalHours[person] || 0) + seconds / 3600;
                });
            });

            const totalHoursBreakdown = Object.entries(totalHours)
                .map(([person, hours]) => {
                    const roundedHours = Math.round(hours);
                    const colorClass = getTimeLogColorClass(roundedHours);
                    return `<div class="${colorClass}">${person}: ${roundedHours}h</div>`;
                })
                .join('');

            totalRow.innerHTML = `
                <td><strong>TOTAL</strong></td>
                <td></td>
                <td></td>
                <td><strong>${totalIssues}</strong></td>
                <td><strong>${totalUatReady}</strong></td>
                <td class="${totalCompletionClass}"><strong>${totalCompleted}</strong></td>
                <td class="${totalCompletionClass}"><strong>${Math.round(totalPercentage)}%</strong></td>
                <td>${totalHoursBreakdown}</td>
            `;

            tbody.appendChild(totalRow);
        }

        function updateCompletionTable(data) {
            const table = document.getElementById('completionTable');
            let html = `
                <tr>
                    <th>Sprint</th>
                    <th>Assignee</th>
                    <th>Started</th>
                    <th>Done</th>
                    <th class="issues-column">Issues</th>
                </tr>`;

            data.forEach(sprint => {
                Object.entries(sprint.completionStats).forEach(([assignee, stats]) => {
                    const completionClass = getCompletionColor(stats.completed, stats.started);
                    html += `
                        <tr>
                            <td>${sprint.name}</td>
                            <td>${assignee}</td>
                            <td>${stats.started}</td>
                            <td class="${completionClass}">${stats.completed}</td>
                            <td class="issues-column">${stats.completedIssues.join(', ')}</td>
                        </tr>`;
                });
            });

            table.innerHTML = html;
        }

        function updateReviewersTable(data) {
            const table = document.getElementById('reviewersTable');
            let html = `
                <tr>
                    <th>Sprint</th>
                    <th>Reviewer</th>
                    <th>Reviewed</th>
                    <th class="issues-column">Issues</th>
                </tr>`;

            data.forEach(sprint => {
                Object.entries(sprint.reviewerStats).forEach(([reviewer, stats]) => {
                    html += `
                        <tr>
                            <td>${sprint.name}</td>
                            <td>${reviewer}</td>
                            <td>${stats.reviewed}</td>
                            <td class="issues-column">${stats.reviewedIssues.join(', ')}</td>
                        </tr>`;
                });
            });

            table.innerHTML = html;
        }

        function updateShippersTable(data) {
            const table = document.getElementById('shippersTable');
            let html = `
                <tr>
                    <th>Sprint</th>
                    <th>Shipper</th>
                    <th>Shipped</th>
                    <th class="issues-column">Issues</th>
                </tr>`;

            data.forEach(sprint => {
                Object.entries(sprint.shipperStats).forEach(([shipper, stats]) => {
                    html += `
                        <tr>
                            <td>${sprint.name}</td>
                            <td>${shipper}</td>
                            <td>${stats.shipped}</td>
                            <td class="issues-column">${stats.shippedIssues.join(', ')}</td>
                        </tr>`;
                });
            });

            table.innerHTML = html;
        }

        function updateSpilloverTable(data) {
            const table = document.getElementById('spilloverTable');
            let html = `
                <tr>
                    <th>Sprint</th>
                    <th>Starter</th>
                    <th>Count</th>
                    <th class="issues-column">Issues</th>
                    <th class="issues-column">Start Dates</th>
                </tr>`;

            data.forEach(sprint => {
                Object.entries(sprint.spilloverStats).forEach(([starter, stats]) => {
                    const issueList = stats.issues.map(issue => issue.key).join(', ');
                    const dateList = stats.issues.map(issue => formatDate(issue.startDate)).join(', ');
                    
                    html += `
                        <tr>
                            <td>${sprint.name}</td>
                            <td>${starter}</td>
                            <td>${stats.count}</td>
                            <td class="issues-column">${issueList}</td>
                            <td class="issues-column">${dateList}</td>
                        </tr>`;
                });
            });

            table.innerHTML = html;
        }

        function updateMissingEstimatesTable(data) {
            console.log('Updating missing estimates table with data:', data);
            const table = document.getElementById('missingEstimatesTable').getElementsByTagName('tbody')[0];
            table.innerHTML = '';

            // Process the data sprint by sprint
            data.forEach(sprint => {
                // Skip if sprint doesn't match filter
                if (currentFilters.sprint !== 'all' && currentFilters.sprint !== sprint.name) {
                    return;
                }

                // Group issues by assignee for this sprint
                const assigneeGroups = {};
                sprint.missingEstimates.forEach(issue => {
                    const assignee = issue.assignee || 'Unassigned';
                    // Skip if assignee doesn't match filter
                    if (currentFilters.assignee !== 'all' && currentFilters.assignee !== assignee) {
                        return;
                    }
                    if (!assigneeGroups[assignee]) {
                        assigneeGroups[assignee] = {
                            count: 0,
                            issues: []
                        };
                    }
                    assigneeGroups[assignee].count++;
                    assigneeGroups[assignee].issues.push(issue.key);
                });

                // Create rows for each assignee in this sprint
                Object.entries(assigneeGroups)
                    .sort((a, b) => b[1].count - a[1].count) // Sort by count in descending order
                    .forEach(([assignee, stats]) => {
                        const row = table.insertRow();
                        row.insertCell().textContent = sprint.name;
                        row.insertCell().textContent = assignee;
                        row.insertCell().textContent = stats.count;
                        row.insertCell().textContent = stats.issues.join(', ');
                    });
            });

            // If no data was added, show a message
            if (table.rows.length === 0) {
                const row = table.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 4;
                cell.textContent = 'No issues missing estimates found for the selected filters';
                cell.style.textAlign = 'center';
                cell.style.fontStyle = 'italic';
                cell.style.color = '#666';
            }
        }

        function updateLeaderboard(data) {
            const leaderboard = document.querySelector('.leaderboard');
            const stats = calculateLeaderboardStats(data);
            
            leaderboard.innerHTML = `
                <a href="#summary" class="leaderboard-card">
                    <h3 class="leaderboard-card-title">‚è±Ô∏è Most Hours Logged</h3>
                    <div class="leaderboard-card-description">
                        Total hours logged in Jira worklogs during sprint periods
                    </div>
                    ${formatLeaderboardEntries(stats.hoursLogged, 'h')}
                </a>
                <a href="#completion" class="leaderboard-card">
                    <h3 class="leaderboard-card-title">‚úÖ Most Issues Completed</h3>
                    <div class="leaderboard-card-description">
                        Number of issues moved to "Done" after being started by the assignee
                    </div>
                    ${formatLeaderboardEntries(stats.issuesCompleted, ' issues')}
                </a>
                <a href="#reviewers" class="leaderboard-card">
                    <h3 class="leaderboard-card-title">üëÄ Top Reviewers</h3>
                    <div class="leaderboard-card-description">
                        Issues moved from "PR Ready" to "Testing" (* indicates indirect transitions)
                    </div>
                    ${formatLeaderboardEntries(stats.reviewed, ' reviews')}
                </a>
                <a href="#shippers" class="leaderboard-card">
                    <h3 class="leaderboard-card-title">üö¢ Top Shippers</h3>
                    <div class="leaderboard-card-description">
                        Issues moved from "Testing" to "UAT Ready" (* indicates indirect transitions)
                    </div>
                    ${formatLeaderboardEntries(stats.shipped, ' shipped')}
                </a>
                <a href="#spillover" class="leaderboard-card">
                    <h3 class="leaderboard-card-title">üéØ Least Spillover Issues</h3>
                    <div class="leaderboard-card-description">
                        Best performers with fewest issues not completed within their sprint
                    </div>
                    ${formatLeaderboardEntries(stats.spillover, ' issues', true)}
                </a>`;
        }

        function calculateLeaderboardStats(data) {
            const stats = {
                hoursLogged: {},
                issuesCompleted: {},
                reviewed: {},
                shipped: {},
                spillover: {}
            };

            data.forEach(sprint => {
                // Hours logged
                Object.entries(sprint.timeLogged).forEach(([person, seconds]) => {
                    stats.hoursLogged[person] = (stats.hoursLogged[person] || 0) + seconds / 3600;
                });

                // Issues completed
                Object.entries(sprint.completionStats).forEach(([person, personStats]) => {
                    stats.issuesCompleted[person] = (stats.issuesCompleted[person] || 0) + personStats.completed;
                });

                // Reviews
                Object.entries(sprint.reviewerStats).forEach(([person, personStats]) => {
                    stats.reviewed[person] = (stats.reviewed[person] || 0) + personStats.reviewed;
                });

                // Shipped
                Object.entries(sprint.shipperStats).forEach(([person, personStats]) => {
                    stats.shipped[person] = (stats.shipped[person] || 0) + personStats.shipped;
                });

                // Spillover issues
                Object.entries(sprint.spilloverStats).forEach(([person, personStats]) => {
                    stats.spillover[person] = (stats.spillover[person] || 0) + personStats.count;
                });
            });

            return stats;
        }

        function formatLeaderboardEntries(data, suffix, invertSort = false) {
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            return Object.entries(data)
                .sort((a, b) => invertSort ? a[1] - b[1] : b[1] - a[1])
                .slice(0, 3)
                .map((entry, index) => `
                    <div class="leaderboard-entry">
                        <span class="leaderboard-medal">${medals[index]}</span>
                        <span>${entry[0]}: ${Math.round(entry[1])}${suffix}</span>
                    </div>`)
                .join('');
        }

        function toggleExplanation(section) {
            const explanation = document.getElementById(`${section}-explanation`);
            const button = explanation.previousElementSibling;
            const icon = button.querySelector('.toggle-icon');
            
            explanation.classList.toggle('visible');
            icon.classList.toggle('rotated');
            button.innerHTML = `<span class="toggle-icon ${explanation.classList.contains('visible') ? 'rotated' : ''}">‚ñ∂</span> ${explanation.classList.contains('visible') ? 'Hide' : 'Show'} calculation details`;
        }

        function toggleIssuesColumn(section) {
            const table = document.getElementById(`${section}Table`);
            const button = table.previousElementSibling.querySelector('.toggle-button');
            const icon = button.querySelector('.toggle-icon');
            const cells = table.getElementsByClassName('issues-column');
            
            Array.from(cells).forEach(cell => cell.classList.toggle('visible'));
            icon.classList.toggle('rotated');
            button.innerHTML = `<span class="toggle-icon ${cells[0].classList.contains('visible') ? 'rotated' : ''}">‚ñ∂</span> ${cells[0].classList.contains('visible') ? 'Hide' : 'Show'} issue details`;
        }

        function toggleIssuesList(section) {
            const button = document.querySelector(`#${section} .toggle-button:nth-of-type(2)`);
            const icon = button.querySelector('.toggle-icon');
            const issuesColumns = document.querySelectorAll(`#${section}Table .issues-column`);
            
            icon.classList.toggle('rotated');
            issuesColumns.forEach(col => col.classList.toggle('visible'));
            
            button.innerHTML = `<span class="toggle-icon${icon.classList.contains('rotated') ? ' rotated' : ''}">‚ñ∂</span> ${icon.classList.contains('rotated') ? 'Hide' : 'Show'} Issues`;
        }

        // Initialize the page
        initializeFilters();
        updateTables();
    </script>
</body>
</html> 